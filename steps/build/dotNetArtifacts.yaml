parameters:
- name: clean
  type: boolean
  default: false
# preSteps
- name: preSteps
  type: stepList
  default: []
- name: checkout
  type: string
  default: self
- name: submodules
  type: string
  default: false
# postSteps
- name: postSteps
  type: stepList
  default: []
- name: artifactName # Default artifact name of dotNet publish
  type: string
  default: '$(Build.BuildNumber)_$(System.StageName)_$(Agent.JobName)'
# dotNet type and version
- name: dotNetType
  type: string
  default: sdk
  values:
  - sdk
  - runtime
- name: dotNetVersion
  type: string
  default: '3.1.x'
# dotNet build/publish params
- name: dotNetProjects # dotNet projects to build or publish
  type: string
- name: dotNetCommand
  type: string
  default: build
  values:
  - build
  - publish
- name: dotNetFeed # Default ADO vsts artifact feed
  type: string
  default: ''
- name: dotNetArguments # additional dotNet arguments
  type: string
  default: ''
- name: dotNetPublishWebProjects
  type: boolean
  default: false

steps:
- template: ../preSteps.yaml
  parameters:
    clean: ${{ parameters.clean }}
    checkout: ${{ parameters.checkout }}
    submodules: ${{ parameters.submodules }}
    download: false
    artifact: ''
    preSteps: ${{ parameters.preSteps }}
- template: ../build/dotNetCore.yaml
  parameters:
    clean: false
    checkout: false
    download: false
    dotNetCommand: ${{ parameters.dotNetCommand }}
    dotNetType: ${{ parameters.dotNetType }}
    dotNetVersion: ${{ parameters.dotNetVersion }}
    dotNetFeed: ${{ parameters.dotNetFeed }}
    dotNetProjects: ${{ parameters.dotNetProjects }}
    dotNetArguments: ${{ parameters.dotNetArguments}}
    ${{ if eq(parameters.dotNetCommand, 'publish') }}:
      publishWebProjects: '${{ parameters.dotNetPublishWebProjects }}'
- template: ../postSteps.yaml
  parameters:
    postSteps: ${{ parameters.postSteps }}
    artifact: ${{ parameters.artifactName }}
    ${{ if eq(parameters.dotNetCommand, 'build') }}:
      publish: '$(Pipeline.Workspace)/Build'
    ${{ if eq(parameters.dotNetCommand, 'publish') }}:
      publish: '$(Pipeline.Workspace)/Publish'
    clean: ${{ parameters.clean }}
